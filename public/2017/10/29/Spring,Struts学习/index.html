<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 2017.10.30 Spring,Struts学习 · 陈昀钊</title><meta name="description" content="2017.10.30 Spring,Struts学习 - 陈昀钊"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yzchen.com/atom.xml" title="陈昀钊"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">LASTEST</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ALL</a></li><li class="nav-list-item"><a href="https://www.uestc.edu.cn/" target="_blank" class="nav-list-link">UNIVERSITY</a></li><li class="nav-list-item"><a href="https://github.com/cyzuestc" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://bbs.uestc.edu.cn/" target="_blank" class="nav-list-link">BBS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">2017.10.30 Spring,Struts学习</h1><div class="post-info">Oct 29, 2017</div><div class="post-content"><p>使用AspectJ的XML配置声明式事务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. 配置声明式事务管理器</span><br><span class="line">创建DataSourceTranscationManager对象</span><br><span class="line"></span><br><span class="line">&lt;!--第一步,配置事务管理器--&gt;</span><br><span class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!--第二步 配置事务的增强--&gt;</span><br><span class="line">&lt;tx:advice id=&quot;txadvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;</span><br><span class="line">    &lt;tx:attributes&gt;</span><br><span class="line">        &lt;!--设置匹配规则--&gt;</span><br><span class="line">        &lt;tx:method name=&quot;account*&quot; propagation=&quot;REQUIRED&quot;/&gt;</span><br><span class="line">        &lt;tx:method name=&quot;insert*&quot;/&gt;</span><br><span class="line">    &lt;/tx:attributes&gt;</span><br><span class="line">&lt;/tx:advice&gt;</span><br><span class="line">&lt;!--第三步 配置切面--&gt;</span><br><span class="line">&lt;aop:config&gt;</span><br><span class="line">    &lt;aop:pointcut id=&quot;pointcut1&quot; expression=&quot;execution(* com.Spring_tx.OrdersService.*(..))&quot;&gt;&lt;/aop:pointcut&gt;</span><br><span class="line">    &lt;aop:advisor advice-ref=&quot;txadvice&quot; pointcut-ref=&quot;pointcut1&quot;&gt;&lt;/aop:advisor&gt;</span><br><span class="line">&lt;/aop:config&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">注解方式实现:</span><br><span class="line">&lt;!--第一步,配置事务管理器--&gt;</span><br><span class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!--第二步--&gt;</span><br><span class="line">    &lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;&gt;&lt;/tx:annotation-driven&gt;</span><br><span class="line">&lt;!--第三步--&gt;</span><br><span class="line">找到@Transactional,里面所有方法加事务管理</span><br></pre></td></tr></table></figure>
<p>Hibernate框架<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ORM思想</span><br><span class="line">实体类与数据库映射</span><br><span class="line">Hibernate与Spring整合,两个核心配置文件名称和位置没有固定要求</span><br><span class="line">hibernate.cfg.xml</span><br></pre></td></tr></table></figure></p>
<p>Hibernate入门学习<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.让实体类和表一一对应 使用配置文件方式</span><br><span class="line"></span><br><span class="line">2. 不需要操作表,只需要操作表对应的实体类对象就可以了</span><br><span class="line"></span><br><span class="line">3. hibernate封装的对象session</span><br><span class="line"></span><br><span class="line">4. 创建实体类对象</span><br><span class="line">User user = new User();</span><br><span class="line">user.setUsername(&quot;lucy&quot;);</span><br><span class="line">session.save(user);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.hibernate要求实体类中有一个属性唯一的值</span><br><span class="line">2.使用hibernate时不需要手动创建表,会自动建表</span><br><span class="line">3.配置实体类和数据库表一一对应关系(使用配置文件实现映射)</span><br><span class="line">配置名称和位置没有固定要求</span><br><span class="line">建议:实体类所在包里创建,名称:Hbm.xml</span><br><span class="line">配置xml首先要引入约束,schema,dtd</span><br><span class="line">引入约束</span><br><span class="line">&lt;!DOCTYPE hibernate-mapping PUBLIC</span><br><span class="line">        &quot;-//Hibernate/Hibernate Mapping DTD 3.0//EN&quot;</span><br><span class="line">        &quot;http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>然后:hibernate的映射<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;hibernate-mapping&gt;</span><br><span class="line">    &lt;!--class</span><br><span class="line">    name:全路径</span><br><span class="line">    table:数据库表的名称--&gt;</span><br><span class="line">    &lt;class name=&quot;cn.itcast.entity.User&quot; table=&quot;t_user&quot;&gt;</span><br><span class="line">        &lt;!--2.配置要求实体类有一个属性唯一值--&gt;</span><br><span class="line">        &lt;!--id:实体类id属性名称,column:表字段名称--&gt;</span><br><span class="line">        &lt;id name=&quot;uid&quot; column=&quot;uid&quot;&gt;</span><br><span class="line">            &lt;!--设置增长策略--&gt;</span><br><span class="line">            &lt;!--native就是自动增长--&gt;</span><br><span class="line">            &lt;generator class=&quot;native&quot;&gt;&lt;/generator&gt;</span><br><span class="line">        &lt;/id&gt;</span><br><span class="line">        &lt;!--配置其他属性和表字段对应--&gt;</span><br><span class="line">        &lt;property name=&quot;username&quot; column=&quot;username&quot;&gt;&lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; column=&quot;password&quot;&gt;&lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;address&quot; column=&quot;address&quot;&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/class&gt;</span><br><span class="line">&lt;/hibernate-mapping&gt;</span><br></pre></td></tr></table></figure></p>
<p>Spring的约束是screma<br>4.创建hibernate的核心配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">核心配置文件格式xml</span><br><span class="line">期名称和位置是固定的</span><br><span class="line">1.位置:src下面</span><br><span class="line">名称:hibernate.cfg.xml</span><br><span class="line">2.引入dtd约束</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE hibernate-configuration PUBLIC</span><br><span class="line">        &quot;-//Hibernate/Hibernate Configuration DTD 3.0//EN&quot;</span><br><span class="line">        &quot;http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd&quot;&gt;</span><br><span class="line">3.hibernate操作中只加载核心配置文件,其他配置文件不会加载</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1.配置数据库信息</span><br><span class="line">2.配置hibernate信息</span><br><span class="line">3.把映射文件放到配置文件中</span><br><span class="line">&lt;hibernate-configuration&gt;</span><br><span class="line">    &lt;session-factory&gt;</span><br><span class="line">        &lt;!--第一部分,必须的--&gt;</span><br><span class="line">        &lt;property name=&quot;hibernate.connection.driver_class&quot; &gt;com.mysql.jdbc.Driver&lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;hibernate.connection.url&quot;&gt;jdbc:mysql://localhost:3306/hibernate&lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;connection.username&quot;&gt;root&lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;connection.password&quot;&gt;admin&lt;/property&gt;</span><br><span class="line">        &lt;!--第二部分,可选--&gt;</span><br><span class="line">        &lt;!--底层输出sql--&gt;</span><br><span class="line">        &lt;property name=&quot;hibernate.show_sql&quot;&gt;true&lt;/property&gt;</span><br><span class="line">        &lt;!--底层输出sql语句格式--&gt;</span><br><span class="line">        &lt;property name=&quot;hibernate.format_sql&quot;&gt;true&lt;/property&gt;</span><br><span class="line">        &lt;!--hibernate帮忙创建表--&gt;</span><br><span class="line">        &lt;!--update如果有表就更新，没表就创建--&gt;</span><br><span class="line">        &lt;property name=&quot;hibernate.hbm2ddl.auto&quot;&gt;update&lt;/property&gt;</span><br><span class="line">        &lt;!--配置数据库的方言--&gt;</span><br><span class="line">        &lt;!--让hibernate识别不同数据库的语句--&gt;</span><br><span class="line">        &lt;property name=&quot;hibernate.dialect&quot;&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;</span><br><span class="line">        &lt;mapping resource=&quot;cn/itcast/entity/User.hbm.xml&quot;&gt;&lt;/mapping&gt;</span><br><span class="line">    &lt;/session-factory&gt;</span><br><span class="line">&lt;/hibernate-configuration&gt;</span><br></pre></td></tr></table></figure>
<p>hibernate操作的步骤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1.加载核心配置文件</span><br><span class="line">2.创建SessionFactory对象</span><br><span class="line">3.使用SessionFactory创建Session对象(与HTTPSession没有任何关系)</span><br><span class="line">4.开启事务</span><br><span class="line">5.写我们具体的逻辑crud</span><br><span class="line">6.提交事务</span><br><span class="line">7.关闭资源/连接</span><br><span class="line"></span><br><span class="line">        Configuration cfg = new Configuration();</span><br><span class="line">        cfg.configure();</span><br><span class="line">        //2. 创建SessionFactory</span><br><span class="line">        //在这个过程中,会找到映射文件,把表也创建出来</span><br><span class="line">        SessionFactory sessionFactory = cfg.buildSessionFactory();</span><br><span class="line">        //3. 创建session对象</span><br><span class="line">        //如何理解:类似于Connection conn = DriverManager.getConnection</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        //4. 开启事务</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        //5. 写具体逻辑</span><br><span class="line">        User user = new User(x);</span><br><span class="line">        user.setUid(123456);</span><br><span class="line">        user.setUsername(&quot;小王&quot;);</span><br><span class="line">        user.setPassword(&quot;123&quot;);</span><br><span class="line">        user.setAddress(&quot;美国&quot;);</span><br><span class="line">        session.save(user);</span><br><span class="line">        //6. 提交事务</span><br><span class="line">        transaction.commit();</span><br><span class="line">        //7. 关闭事务</span><br><span class="line">        session.close();</span><br><span class="line">        sessionFactory.close();</span><br></pre></td></tr></table></figure></p>
<p>hibernate配置文件详解<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. hibernate映射文件名称位置不固定</span><br><span class="line">2.关于映射配置文件</span><br><span class="line">内部中写的都是实体类相关的</span><br><span class="line">- 1. class的name属性值是实体类的全路径</span><br><span class="line">- 2. id标签和property的name都是实体类属性名称</span><br><span class="line">3.id标签好property标签,column属性可以省略,表的字段自动与实体类属性名称一致</span><br></pre></td></tr></table></figure></p>
<p>hibernate中核心api的使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">创建SessionFactory特别耗费资源</span><br><span class="line">所以在hibernate操作中,建议一个项目创建一个sessionFactory</span><br><span class="line">具体实现:</span><br><span class="line">1.写工具类,写静态代码实现</span><br><span class="line">public class HibernateUtils &#123;</span><br><span class="line">    static Configuration cfg = null;</span><br><span class="line">    static SessionFactory sessionFactory = null;</span><br><span class="line">    static &#123;</span><br><span class="line">        //加载核心配置文件</span><br><span class="line">        cfg = new Configuration();</span><br><span class="line">        cfg.configure();</span><br><span class="line">        SessionFactory sessionFactory = cfg.buildSessionFactory();</span><br><span class="line">    &#125;</span><br><span class="line">    public static SessionFactory getSessionFactory()&#123;</span><br><span class="line">        return sessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>Session(重点)</p>
<ol>
<li>类似于jdbc中的connection</li>
<li>调用session里面的不同方法实现crud操作</li>
</ol>
<ul>
<li>1.添加 save方法</li>
<li>2 修改 update方法</li>
<li><ol start="3">
<li>删除方法</li>
</ol>
</li>
<li><ol start="4">
<li>根据id查询get方法</li>
</ol>
</li>
</ul>
<ol start="3">
<li>一个项目一般只创建一个SessionFactory.session对象单线程对象,不能共用,只能自己用</li>
</ol>
<hr>
<p>Transaction<br>Transaction tx = session.beginTransaction();<br>tx.commit();<br>tx.rollback();<br>事务概念</p>
<ul>
<li>1.原子性:一种操作一种失败都失败</li>
<li>2.一致性:操作之前之后要一致</li>
<li>3.隔离性:多个事务同时操作不影响</li>
<li>4.持久性:提交数据库后持久性</li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">实体类的编写规则</span><br><span class="line">实体类不建议使用基本数据类型,而是包装类</span><br><span class="line">因为包装类Interger 可以为null,可以为0;</span><br><span class="line">实体类也叫做持久化类</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hibernate主键生成策略</span><br><span class="line">increment:每次增量为1</span><br><span class="line">identity:数据库支持自动自动增长的类型.适用于代理主键</span><br><span class="line">sequence:条件是数据库支持序列,如oracle</span><br><span class="line">native:根据底层数据库对自动生成标识符</span><br><span class="line">uuid:32位16进制字符串 column=&quot;uuid&quot;</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">对实体类crud的操作</span><br><span class="line">1.添加</span><br><span class="line">调用sesson save方法</span><br><span class="line">sesson.save(user);</span><br><span class="line">2.根据id查询</span><br><span class="line">User user = session.get(User.class,1);</span><br><span class="line">3.修改</span><br><span class="line">先查询,再修改</span><br><span class="line">User user = session.get(User.class,1);</span><br><span class="line">user.setUserName(&quot;newName&quot;);</span><br><span class="line">session.update(user);</span><br><span class="line">4.删除</span><br><span class="line">User user = session.get(User.class,1);</span><br><span class="line">session.delete(user);</span><br></pre></td></tr></table></figure>
<p>实体类对象的状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">瞬态值:</span><br><span class="line">持久态:</span><br><span class="line">托管态:</span><br></pre></td></tr></table></figure></p>
<p>Hibernate的一级缓存<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. 把数据存在数据库里,数据库本身是文件系统,可以直接用流方式操作文件效率不高</span><br><span class="line">2. 把数据放在内存中,提高效率</span><br><span class="line"></span><br><span class="line">Hibernate的缓存特点:</span><br><span class="line">1.Hibernate的一级缓存</span><br><span class="line">- 1 默认打开</span><br><span class="line">- 2 一级缓存有使用范围,从session创建到session关闭的范围.</span><br><span class="line">- 3 一级缓存中存储数据必须是持久态数据</span><br><span class="line">2. Hibernate的二级缓存已经没人使用,有一种替代技术,redis</span><br><span class="line">- 1 默认不打开,需要配置</span><br><span class="line">- 2 使用范围是整个web范围,SessionFactory范围.一个项目只有这一个对象</span><br></pre></td></tr></table></figure></p>
<p>验证方式:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.根据uid=1查询</span><br><span class="line">2.再根据uid=1查询</span><br><span class="line">验证第二次没有发送sql语句(第二次不查数据库而查一级缓存)</span><br></pre></td></tr></table></figure></p>
<p>一级缓存的特性:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">持久态会自动更新数据库</span><br><span class="line">User user = session.get(User.class,7)</span><br><span class="line">把user放在一级缓存快照区</span><br><span class="line">user.setUsernamme(&quot;hanmeimei&quot;)</span><br><span class="line">修改的是持久态对象的值</span><br><span class="line">同时修改一级缓存的内容,但不一定修改一级缓存对应的快照区内容.</span><br><span class="line">最后提交事务,会:</span><br><span class="line">比较一级缓存和快照区内容是否相同,如果不同会把一级缓存区存放在数据库中</span><br></pre></td></tr></table></figure></p>
<hr>
<p>事务代码规范<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1.不考虑隔离产生的问题</span><br><span class="line">-1 脏读</span><br><span class="line">-2 不可重复度</span><br><span class="line">-3 虚读</span><br><span class="line">解决方法:</span><br><span class="line">设置事务隔离级别. 默认级别</span><br><span class="line">-1 mysql默认隔离级别是repeatable read</span><br><span class="line">&lt;property name=&quot;hibernate.connection.isolation&quot;&gt;4&lt;/property&gt;</span><br><span class="line">try&#123;</span><br><span class="line">    sessionFactory=HibernateUtils.getSessionFactory();</span><br><span class="line">    session = sessionFactory.openSession();</span><br><span class="line">    tx = session.beginTransaction();</span><br><span class="line">    ...</span><br><span class="line">    tx.commit();</span><br><span class="line">&#125;catch()&#123;</span><br><span class="line">    session.rollback();</span><br><span class="line">    &#125;</span><br><span class="line">finaly&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>hibernate绑定session<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">配置与本地线程绑定的session</span><br><span class="line">获取本地线程绑定session,关闭session报错</span><br></pre></td></tr></table></figure></p>
<p>struts2 重点:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1.Action操作</span><br><span class="line">- 1.创建继承ActionSupport</span><br><span class="line">- 2.配置action的访问路径,创建struts.xml的配置文件,其固定在src下面</span><br><span class="line">- 3.配置多个action访问方法</span><br><span class="line">- 4.在action获取表单提交数据</span><br><span class="line">-- 1.获取request对象</span><br><span class="line">模型驱动(重点)</span><br><span class="line">--6.配置过滤器</span><br><span class="line">2.值栈</span><br><span class="line">-1. 向值栈中放置数据</span><br><span class="line">- set方法,push方法,定义变量,生成get方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.拦截器</span><br><span class="line">- 1. aop和责任链模式</span><br><span class="line">- 2. 自定义拦截器</span><br><span class="line">继承MethodFilterInterceptor</span><br><span class="line">重写方法</span><br><span class="line">配置拦截器和action的关联</span><br></pre></td></tr></table></figure></p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/10/29/操作系统学习/" class="prev">PREV</a><a href="/2017/10/28/Spring学习/" class="next">NEXT</a></div><div class="copyright"><p>© 2018 powered by <a href="https://github.com/cyzuestc" target="_blank">Chenyunzhao</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>