<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 2017.10.29 Spring,Struts学习 · 陈昀钊</title><meta name="description" content="2017.10.29 Spring,Struts学习 - 陈昀钊"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yzchen.com/atom.xml" title="陈昀钊"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://www.uestc.edu.cn/" target="_blank" class="nav-list-link">UNIVERSITY</a></li><li class="nav-list-item"><a href="https://github.com/cyzuestc" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://bbs.uestc.edu.cn/" target="_blank" class="nav-list-link">清水河畔</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">2017.10.29 Spring,Struts学习</h1><div class="post-info">Oct 29, 2017</div><div class="post-content"><p>使用表达式配置切入点:<br>常用的表达式:<br>execution(“<em> cn.itcast.aop.Book.add(..)”)<br>execution(“</em> cn.itcast.aop.Book.*(..)”)</p>
<h2 id="execution-“-”"><a href="#execution-“-”" class="headerlink" title="execution(“ .*(..)”)"></a>execution(“<em> </em>.*(..)”)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">配置切面的方法:</span><br><span class="line">&lt;aop:config&gt;</span><br><span class="line">    &lt;aop:poingcut id=&quot;pointcut1&quot; expresson=&quot;cn...(此处为需要添加前置方法的方法)&quot;&gt;&lt;/aop:pointcut&gt;</span><br><span class="line">    &lt;aop:aspect ref=&quot;beforeMethod&quot;(此处为上面配置过的目标类)&gt;</span><br><span class="line">        &lt;aop:before method=&quot;say&quot;(此处为要执行那个前置方法) pointcut-ref=&quot;pointcut1&quot;&gt;&lt;/aop:before&gt;</span><br><span class="line">    &lt;/aop:aspect&gt;</span><br><span class="line">&lt;/aop:config&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">配置环绕的方法</span><br><span class="line">&lt;aop:before method=&quot;before1&quot; pointcut-ref=&quot;pointcut1&quot;/&gt;</span><br><span class="line">&lt;aop:after-returning method=&quot;after1&quot; pointcut-ref=&quot;pointcut1&quot;/&gt;</span><br><span class="line">&lt;aop:around method=&quot;around&quot; pointcut-ref=&quot;pointcut1&quot;/&gt;</span><br><span class="line"></span><br><span class="line">public void around1(ProceedingJoinPoint proceedingJoinPoint)  throws Throwable&#123;</span><br><span class="line">    sout(&quot;方法之前&quot;);</span><br><span class="line">    proceedingJoinPoint.proceed();</span><br><span class="line">    sout(&quot;方法之后&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>导入log4j<br>log4j.properties放到src目录下面<br>设置日志级别<br>log4j.rootLogger=info , stdout 基本信息级别</p>
<h2 id="log4j-rootLogger-debug-stdout详细信息级别"><a href="#log4j-rootLogger-debug-stdout详细信息级别" class="headerlink" title="log4j.rootLogger=debug , stdout详细信息级别"></a>log4j.rootLogger=debug , stdout详细信息级别</h2><ol>
<li>Struts2框架应用在javaee中web层</li>
<li>Struts2框架在Struts1和webwork基础上发展的全新框架</li>
<li>struts可以解决的问题:</li>
</ol>
<hr>
<p>配置:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;struts&gt;</span><br><span class="line">    &lt;package name=&quot;hellodemo&quot; extends=&quot;struts-default&quot; namesapce=&quot;/&quot;&gt;</span><br><span class="line">        &lt;action name=&quot;hello&quot; class=&quot;cn.itcast.action.HelloAction&quot;&gt;</span><br><span class="line">            &lt;result name=&quot;ok&quot;&gt;/hellp.jsp&lt;/result&gt;</span><br><span class="line">        &lt;/action&gt;</span><br><span class="line">    &lt;/package&gt;</span><br><span class="line">&lt;/struts&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">访问路径:127.0.0.1/struts2_day01/hello.action</span><br><span class="line">配置过滤器:</span><br><span class="line">web.xml中配置</span><br><span class="line">&lt;filter&gt;</span><br><span class="line">    &lt;filter-name&gt;strut2</span><br><span class="line">    &lt;filter-class&gt;&lt;/filter-class&gt;</span><br><span class="line">&lt;/filter&gt;</span><br><span class="line">&lt;filter-mapping&gt;</span><br><span class="line">    &lt;filter-name&gt;structs2&lt;/filter-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">&lt;/filter-mapping&gt;</span><br><span class="line">&lt;/filter&gt;</span><br><span class="line"></span><br><span class="line">result标签:</span><br><span class="line">根据action的方法返回值,配置到不同的路径里面</span><br><span class="line">&lt;result name=&quot;ok&quot; type=&quot;&quot;&gt;/hello.jsp&lt;/result&gt;</span><br><span class="line">默认转发,地址栏不变</span><br></pre></td></tr></table></figure></p>
<p>分模块开发:引入xml文件,开发中最常见的方式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;include file=&quot;cn/itcast/action/hello.xml&quot;&gt;&lt;/include&gt;</span><br></pre></td></tr></table></figure></p>
<p>action的编写方式有三种<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">第一种:创建普通类,这个类不继承任何类,也不实现任何接口.</span><br><span class="line"></span><br><span class="line">第二种:创建类实现Action接口(要实现接口,接口中方法必须实现,所以这种用的不多)</span><br><span class="line"></span><br><span class="line">第三种:创建类,继承ActionSupport</span><br></pre></td></tr></table></figure></p>
<p>访问action的方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">有三种方式实现,主要前面两种方式</span><br><span class="line">1. 使用action标签中的method属性,在这个属性里写执行的action方法</span><br><span class="line">2. 使用通配符的方式实现</span><br><span class="line">3. 动态访问方式(不用)</span><br></pre></td></tr></table></figure></p>
<p>演示错误:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如果action中有返回值,在配置文件中没有配置, 出现错误.</span><br><span class="line">no result defined for action and result ok</span><br><span class="line"></span><br><span class="line">没有返回值,就return Action.NONE</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Action的方法访问</span><br><span class="line">1.这是第一种实现方式,但不适合方法多的项目</span><br><span class="line">&lt;action name=&quot;updateAction&quot; class=&quot;cn...&quot; method=&quot;update&quot;&gt;&lt;/action&gt;</span><br><span class="line">2.第二种,通配符方法:&#123;1&#125;用来去*的值</span><br><span class="line">&lt;action name=&quot;book_*&quot; class=&quot;&quot; method=&quot;&#123;1&#125;&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>基于aspectj的注解<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">增强方法,创建对象,jnx;aop配置,配置切面,用注解方式实现</span><br><span class="line">1.创建对象</span><br><span class="line">2.在spring核心配置文件中,开启aop扫描操作</span><br><span class="line">    &lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;</span><br><span class="line">3.在增强的类上面完成注解</span><br><span class="line">@Before(value = &quot;execution(* com.Spring_aop.Book.*(..))&quot;)</span><br></pre></td></tr></table></figure></p>
<p>Spring的jdbcTemplate操作<br>1.spring框架一站式框架</p>
<ul>
<li>1.针对三层,每一层都有解决技术</li>
<li>2.在dao层,使用jdbcTemplate<br>3.jdbcTemplate的使用和dbutils使用很相似,都是对数据库进行crud操作.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DriverManagerDataSource driverManagerDataSource = new DriverManagerDataSource();</span><br><span class="line">driverManagerDataSource.setDriverClassName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">driverManagerDataSource.setUrl(&quot;jdbc:mysql://localhost:3306/spring&quot;);</span><br><span class="line">driverManagerDataSource.setUsername(&quot;root&quot;);</span><br><span class="line">driverManagerDataSource.setPassword(&quot;admin&quot;);</span><br><span class="line">//2.创建jdbc模板对象</span><br><span class="line">JdbcTemplate jdbcTemplate = new JdbcTemplate(driverManagerDataSource);</span><br><span class="line">//3.调用里面的方法</span><br><span class="line">String sql = &quot;insert into test values(?,?)&quot;;</span><br><span class="line">//String sql = &quot;update test set password = ? where username=?&quot;;</span><br><span class="line">//String sql = &quot;delete from test  where username=?&quot;;</span><br><span class="line"></span><br><span class="line">int rows = jdbcTemplate.update(sql,&quot;lucy&quot;,&quot;350&quot;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">QueryRunner qr = new QueryRunner(datasource);</span><br><span class="line">返回对象</span><br><span class="line">runner.query(sql,new BeanHandler&lt;User&gt;.class)</span><br><span class="line">返回list</span><br><span class="line">runner.query(sql,new BeanListHandler&lt;User&gt;.class)</span><br><span class="line"></span><br><span class="line">在dbutils时候,有接口ResultSetHandler</span><br><span class="line">dbutils提供了不同结果实现类</span><br><span class="line">2. jdbcTemplate实现查询,有接口RowMapper</span><br><span class="line">jdbcTemplate针对这个接口没有实现类,得到不同的数据需要自己进行数据的封装</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">查询的具体实现</span><br><span class="line">1.查询返回某一个值</span><br><span class="line">select count(*) from test</span><br><span class="line"> String sql = &quot;select count(*) from test&quot;;</span><br><span class="line">Integer count = jdbcTemplate.queryForObject(sql,Integer.class);</span><br><span class="line">2.查询返回某一个对象</span><br><span class="line"></span><br><span class="line">User user = jdbcTemplate.queryForObject(sql,new MyRowMapper(),&quot;a&quot;);</span><br><span class="line"></span><br><span class="line">class MyRowMapper implements RowMapper&lt;User&gt;&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public User mapRow(ResultSet resultSet, int i) throws SQLException &#123;</span><br><span class="line">        String username = resultSet.getString(&quot;username&quot;);</span><br><span class="line">        String password = resultSet.getString(&quot;password&quot;);</span><br><span class="line">        User user = new User();</span><br><span class="line">        user.setName(username);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line">        return user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3.查询返回list</span><br><span class="line">String sql = &quot;select * from test&quot;;</span><br><span class="line">List&lt;User&gt; list = jdbcTemplate.query(sql,new MyRowMapper());</span><br></pre></td></tr></table></figure>
<hr>
<p>String配置连接池和dao使用jdbcTemplate<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.Spring配置c3p0连接池</span><br><span class="line">jar:c3p0,mchange-commons</span><br><span class="line">2.创建Spring的配置文件,将一下代码配入配置文件中</span><br><span class="line">ComboPooledDataSource dataSource = new ComboPooledDataSource();</span><br><span class="line">dataSource.setDriverClass(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">dataSource.setJdbcUrl(&quot;jdbc:mysql://localhost:3306/spring&quot;);</span><br><span class="line">dataSource.setUser(&quot;root&quot;);</span><br><span class="line">dataSource.setPassword(&quot;admin&quot;);</span><br></pre></td></tr></table></figure></p>
<p>将上面的代码用xml实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    &lt;!-- 配置c3p0--&gt;</span><br><span class="line">    &lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</span><br><span class="line">        &lt;!--注入属性值--&gt;</span><br><span class="line">        &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/spring&quot;&gt;&lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;user&quot; value=&quot;root&quot;&gt;&lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;admin&quot;&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;bean id=&quot;userDao&quot; class=&quot;com.Springtest.UserDao&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate&quot;&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;bean id=&quot;userService&quot; class=&quot;com.Springtest.UserService&quot;&gt;</span><br><span class="line">        &lt;property ref=&quot;userDao&quot; name=&quot;userDao&quot;&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></p>
<p>Spring事务管理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">事务相关的概念</span><br><span class="line">1.要么都成功,要么都失败</span><br><span class="line">2.特性:原子性,一致性,隔离性,持久性</span><br><span class="line">3.不考虑隔离性,会产生三个不可读的问题</span><br><span class="line">解决读问题:设置隔离级别</span><br><span class="line"></span><br><span class="line">Spring进行事务管理</span><br><span class="line">api:</span><br><span class="line">哪些类,那些接口</span><br><span class="line">两种方式:</span><br><span class="line">1. 编程式事务管理(不用)</span><br><span class="line">2. 声明式事务管理(主要)</span><br><span class="line">xml配置和注解实现</span><br><span class="line">2.事务管理中的api:</span><br><span class="line">事务管理器:接口:PlatformTransactionManager</span><br><span class="line">Spring为不同的持久化框架都提供了不同的platformTransactionManager接口实现</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">搭建转账环境</span><br><span class="line">service又叫做业务逻辑层</span><br><span class="line">1.创建数据库表,添加数据</span><br></pre></td></tr></table></figure></div></article></div></main><footer><div class="paginator"><a href="/2017/10/29/2017.10.29 操作系统学习/" class="prev">PREV</a><a href="/2017/10/28/2017.10.28 Spring学习/" class="next">NEXT</a></div><div class="copyright"><p>© 2018 powered by <a href="https://github.com/cyzuestc" target="_blank">Chenyunzhao</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>